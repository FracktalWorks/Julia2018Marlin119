#!/usr/bin/env bash
# header

declare -a VARIANT=("JULIA_2018_GLCD" "JULIA_2018_GLCD_HB" "JULIA_2018_RPI" "JULIA_2018_RPI_E")
declare -a SHORT_VARIANT=("J18GX" "J18GB" "J18RX" "J18RE")
declare -a MACHINE_NAME=("Julia 2018 Basic" "Julia 2018 Intermediate" "Julia 2018 Advanced" "Julia 2018 Extended")

BUILDATE=$(date '+%s')
DISTDATE=$(date '+%Y-%m-%d %H:%M')
SBV1=$(date '+%y%m%d_%H%M')
SHORT_BUILD_VERSION=$(echo "${SHORT_VARIANT[$2]}_${SBV1^^}")
DETAILED_BUILD_VERSION=$(echo "${SHORT_BUILD_VERSION}_HA")

echo "Generating build for version ${DETAILED_BUILD_VERSION}"

cat > "$1/_Version.h" <<EOF
/**
 * THIS FILE IS AUTOMATICALLY GENERATED DO NOT MANUALLY EDIT IT.
 * IT DOES NOT GET COMMITTED TO THE REPOSITORY.
 */

#define BUILD_UNIX_DATETIME "${BUILDATE}"
#define STRING_DISTRIBUTION_DATE "${DISTDATE}"

#define SHORT_BUILD_VERSION "${SHORT_BUILD_VERSION}"
#define DETAILED_BUILD_VERSION "${DETAILED_BUILD_VERSION}"

#define REQUIRED_CONFIGURATION_H_VERSION 010100
#define REQUIRED_CONFIGURATION_ADV_H_VERSION 010100
#define PROTOCOL_VERSION "1.0"
#define MACHINE_NAME "${MACHINE_NAME[$2]}"
#define SOURCE_CODE_URL "https://github.com/aharshac/FWJulia2018Marlin"
#define DEFAULT_MACHINE_UUID "cede2a2f-41a2-4748-9b12-c55c62f367ff"
#define WEBSITE_URL "https://fracktal.in"
EOF

cat > "$1/_FracktalWorks.h" <<EOF
#ifndef _FRACKTAL_WORKS_H
#define _FRACKTAL_WORKS_H

#define JULIA_2018_GLCD				0
#define JULIA_2018_GLCD_HB		1
#define JULIA_2018_RPI				2
#define JULIA_2018_RPI_E			3

#define VARIANT ${VARIANT[$2]}

#ifndef VARIANT
	#error "Variant not defined"
#endif

#define BV(var) (VARIANT == var)

#endif // _FRACKTAL_WORKS_H
EOF